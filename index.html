<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"/>
<title>Arapça Klavye Oyunu</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Harmattan:wght@400;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Marhey:wght@400;700&display=swap" rel="stylesheet"/>
<style>
        html { font-size: clamp(12px, 1.2vw, 16px); }

        :root {
            --bg-start: #f7f9fc; --bg-end: #e8eef5; --primary-color: #5E81AC; --accent-color: #f7b733; --surface-color: #FFFFFF; --text-color: #2e3440; --text-light-color: #FFFFFF; --correct-color: #2ddc73; --incorrect-color: #f24c4c; --shadow-light: rgba(46, 52, 64, 0.07); --shadow-medium: rgba(46, 52, 64, 0.12); --border-radius-sm: 8px; --border-radius-md: 12px; --border-radius-lg: 16px;
            --button-bg: var(--surface-color); --button-shadow: 0 3px #d8dee9; --button-hover-bg: #eceff4; --button-selected-bg: var(--primary-color); --button-selected-color: var(--text-light-color); --button-selected-shadow: 0 0 0 3px var(--accent-color);
            --easy-color: #a3be8c; --medium-color: #ebcb8b; --hard-color: #bf616a;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        html, body { width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; }

        body { font-family: 'Marhey', sans-serif; background-color: var(--bg-start); background-image: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%); color: var(--text-color); text-align: center; text-rendering: optimizeLegibility; }
        button, input { font-family: inherit; }

        #game-wrapper { width: 100%; height: 100%; position: relative; }

        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; position: absolute; top: 0; left: 0; transition: opacity 0.5s; overflow-y: auto; padding: 20px; }
        .screen.active { display: flex; }

        /* --- Başlangıç Ekranı --- */
        #start-screen { gap: 25px; justify-content: center; }
        .start-title { font-size: clamp(2.2rem, 5vw, 3rem); color: var(--text-color); margin-bottom: 10px; }
        .difficulty-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; width: 100%; max-width: 500px; margin-bottom: 20px; }
        .difficulty-button { background-color: var(--button-bg); border: 2px solid transparent; border-radius: var(--border-radius-md); padding: 15px 20px; font-size: 1.3rem; font-weight: bold; color: var(--text-color); cursor: pointer; transition: all 0.2s ease; box-shadow: var(--button-shadow); }
        .difficulty-button:hover { background-color: var(--button-hover-bg); transform: translateY(-1px); box-shadow: 0 4px #cdd3db; }
        .difficulty-button:active { transform: translateY(1px); box-shadow: 0 2px #d8dee9; }
        .difficulty-button.selected { transform: none; }
        .difficulty-button[data-difficulty="easy"].selected { background-color: var(--easy-color); color: var(--text-light-color); border-color: darken(var(--easy-color), 10%); box-shadow: 0 0 10px rgba(163, 190, 140, 0.5); }
        .difficulty-button[data-difficulty="medium"].selected { background-color: var(--medium-color); color: var(--text-color); border-color: darken(var(--medium-color), 10%); box-shadow: 0 0 10px rgba(235, 203, 139, 0.5); }
        .difficulty-button[data-difficulty="hard"].selected { background-color: var(--hard-color); color: var(--text-light-color); border-color: darken(var(--hard-color), 10%); box-shadow: 0 0 10px rgba(191, 97, 106, 0.5); }

        #start-game-btn { margin-top: 15px; font-size: 1.6rem; font-weight: bold; padding: 12px 30px; border-radius: var(--border-radius-md); border:none; width: 100%; max-width: 500px;}
        #start-game-btn:disabled { background-color: #bdc3c7; color: #7f8c8d; opacity: 0.7; box-shadow: none; cursor: not-allowed; transform: none; }
        #start-game-btn:not(:disabled) { background-color: var(--correct-color); color: white; animation: button-glow 1.5s infinite ease-in-out; cursor: pointer; box-shadow: 0 4px 15px rgba(45, 220, 115, 0.4); }

        /* --- Oyun Ekranı --- */
        #typing-screen { justify-content: center; gap: 15px; padding: 15px 15px 20px 15px; }
        .header-navigation { position: absolute; top: 10px; left: 10px; z-index: 200; }
        .back-btn { background: none; border: none; cursor: pointer; padding: 5px; }
        .back-btn svg { width: 35px; height: 35px; fill: var(--text-color); transition: all 0.2s; opacity: 0.8; filter: drop-shadow(0 1px 2px var(--shadow-light)); }
        .back-btn:hover svg { opacity: 1; transform: scale(1.1); }
        .hidden { display: none !important; }

        #typing-main-container { display: flex; flex-direction: column; width: 100%; gap: 15px; align-items: center; }
        #typing-game-area { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px; flex-grow: 0; justify-content: center; }
        #typing-interactive-elements { width: 100%; max-width: 800px; display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 10px; }
        .countdown-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(46, 52, 64, 0.85); z-index: 200; display: none; justify-content: center; align-items: center; font-size: clamp(8rem, 30vw, 15rem); font-weight: bold; color: var(--accent-color); text-shadow: 0 0 15px rgba(247, 183, 51, 0.5);}
        .typing-stats { display: flex; justify-content: space-between; align-items: center; width: 100%; font-size: 1.6rem; gap: 20px; flex-shrink: 0; }
        .stat-item { position: relative; display: flex; align-items: center; gap: 8px; background-color: var(--surface-color); padding: 6px 12px; border-radius: var(--border-radius-md); transition: all 0.3s; box-shadow: 0 2px 8px var(--shadow-light); }
        .score-effects-container-typing { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; overflow: visible; }
        .typing-score-effect { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); font-size: 2.2rem; font-weight: bold; color: var(--correct-color); text-shadow: 1px 1px 2px rgba(255,255,255,0.7); animation: pop-up-and-fade 1.5s ease-out forwards; }
        @keyframes pop-up-and-fade { 0% { transform: translate(-50%, 0) scale(0.5); opacity: 1; } 50% { transform: translate(-50%, -50px) scale(1.1); opacity: 1; } 100% { transform: translate(-50%, -70px) scale(0.8); opacity: 0; } }
        .stat-item svg { width: 28px; height: 28px; fill: var(--primary-color); }
        
        .progress-container { width: 100%; text-align: center; margin-bottom: 10px; flex-shrink: 0;}
        .word-progress-bar {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: minmax(0, 1fr);
            column-gap: 10px;
            width: 100%;
            max-width: 800px;
            padding: 5px 10px;
            justify-content: stretch;
            direction: rtl;
            margin-bottom: 10px;
            flex-shrink: 0;
            border-radius: var(--border-radius-sm);
            background-color: rgba(0,0,0,0.02);
        }
        
        .word-progress-item {
             font-family: 'Harmattan', sans-serif !important;
             font-size: 1.2rem;
             padding: 4px 8px;
             border-radius: var(--border-radius-sm);
             background-color: #e5e9f0;
             color: #6c757d;
             white-space: nowrap;
             transition: all 0.3s ease;
             border: 1px solid transparent;
        }
        .word-progress-item.active { background-color: var(--accent-color); color: var(--text-color); border-color: darken(var(--accent-color), 10%); font-weight: bold;}
        .word-progress-item.correct { background-color: var(--correct-color); color: var(--text-light-color); border-color: darken(var(--correct-color), 10%); }
        .word-progress-item.incorrect { background-color: var(--incorrect-color); color: var(--text-light-color); border-color: darken(var(--incorrect-color), 10%); }

        #typing-prompt { direction: rtl; font-family: 'Harmattan', sans-serif !important; font-size: clamp(2.5rem, 7vw, 4.5rem); font-weight: bold; background-color: var(--surface-color); border-radius: var(--border-radius-lg); min-height: 120px; display: flex; align-items: center; justify-content: center; width: 100%; box-shadow: 0 4px 15px var(--shadow-light); padding: 10px; flex-shrink: 0; line-height: 1.2;}
        .typing-input-area { display: flex; align-items: stretch; gap: 10px; width: 100%; flex-direction: row; flex-shrink: 0; }
        #typing-input { font-size: 2rem; flex-grow: 1; padding: 12px; border-radius: var(--border-radius-md); border: 2px solid #d8dee9; background: var(--surface-color); color: var(--text-color); text-align: right; direction: rtl; transition: box-shadow 0.2s, border-color 0.2s; font-family: 'Harmattan', sans-serif !important; }
        #typing-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(94, 129, 172, 0.2); }
        #typing-input:disabled { background-color: #eceff4; cursor: not-allowed; }
        #typing-input.correct-input { border-color: var(--correct-color); }
        #typing-input.incorrect-input { border-color: var(--incorrect-color); animation: shake 0.5s; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        
        #typing-submit-btn {
            border: none; background-color: var(--correct-color); color: var(--text-light-color); border-radius: var(--border-radius-md); padding: 0; width: 80px; flex-shrink: 0; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px darken(var(--correct-color), 10%);
            display: flex; align-items: center; justify-content: center;
        }
        #typing-submit-btn:hover {
            background-color: darken(var(--correct-color), 5%);
            transform: translateY(-1px); box-shadow: 0 5px darken(var(--correct-color), 10%);
        }
        #typing-submit-btn:active {
            background-color: darken(var(--correct-color), 10%);
            transform: translateY(1px); box-shadow: 0 2px darken(var(--correct-color), 10%);
        }
        #typing-submit-btn svg { width: 30px; height: 30px; fill: white; pointer-events: none; }
        
        #virtual-keyboard { direction: rtl; padding: 10px; display: flex; flex-direction: column; gap: 6px; background-color: rgba(0,0,0,0.03); border-radius: var(--border-radius-md); width: 100%; max-width: 800px; transition: all 0.3s; flex-shrink: 0; margin-top: 15px; }
        .keyboard-row { display: flex; justify-content: center; gap: 6px; }
        .keyboard-key { font-family: 'Harmattan'; color: var(--text-color); border: none; border-radius: var(--border-radius-sm); font-size: clamp(1.2rem, 3vw, 1.8rem); padding: clamp(6px, 1.5vh, 10px) clamp(3px, 1vw, 6px); cursor: pointer; transition: all 0.1s ease; flex: 1; display: flex; justify-content: center; align-items: center; min-height: 40px; }
        .keyboard-key:active { transform: translateY(2px); }
        .keyboard-key.backspace { background-color: #e5e9f0; flex-grow: 1.5;}
        .keyboard-key svg { width: clamp(18px, 4vw, 22px); height: clamp(18px, 4vw, 22px); fill: var(--text-color); pointer-events: none;}
        .keyboard-key.space-bar { position: relative; background-color: #e5e9f0; flex-grow: 6;}
        
        #typing-prompt.start-mode {
             background-color: var(--correct-color); color: var(--text-light-color); cursor: pointer;
             animation: pulse-start 2.5s infinite ease-in-out;
             font-family: 'Marhey', sans-serif !important; font-weight: 700; font-size: clamp(2rem, 5vw, 3rem);
         }
        @keyframes pulse-start {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 15px var(--shadow-light); opacity: 0.95; }
            50% { transform: scale(1.03); box-shadow: 0 6px 20px rgba(45, 220, 115, 0.3); opacity: 1; }
        }

        /* --- Sonuç Ekranı --- */
        .results-screen { justify-content: center; gap: 20px; padding: 20px 15px 40px 15px; }
        .results-screen h2 { font-size: clamp(2.2rem, 5vw, 3.5rem); margin-bottom: 15px; }
        .results-stats { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; font-size: 1.2rem; }
        .results-stat-item { background-color: var(--surface-color); padding: 8px 12px; border-radius: var(--border-radius-md); box-shadow: var(--shadow-light); }
        .results-stat-item strong { color: var(--primary-color); margin-left: 5px; }
        
        #results-details { text-align: left; width: 100%; max-width: 700px; max-height: 40vh; overflow-y: auto; background: var(--surface-color); padding: 20px; border-radius: var(--border-radius-md); box-shadow: var(--shadow-light); margin-bottom: 20px;}
        #results-details h3 { font-size: 1.8rem; margin-bottom: 15px; color: var(--incorrect-color); }
        #results-details ul { list-style: none; padding: 0; margin: 0; }
        #results-details li {
            margin-bottom: 20px;
            font-size: 1.6rem;
            line-height: 1.8;
            padding-bottom: 15px;
            border-bottom: 1px solid #e5e9f0;
        }
        #results-details li:last-child { border-bottom: none; }
        #results-details .prompt { font-weight: bold; direction: rtl; display: inline-block; margin-right: 5px; font-size: 1.7rem; }
        #results-details .user-answer { font-size: 1.6rem; color: var(--incorrect-color); text-decoration: line-through; background-color: rgba(240, 128, 128, 0.2); padding: 2px 5px; border-radius: var(--border-radius-sm); direction: rtl; display: inline-block; margin: 0 3px;}
        #results-details .correct-answer { font-size: 1.6rem; color: var(--correct-color); background-color: rgba(143, 188, 143, 0.2); padding: 2px 5px; border-radius: var(--border-radius-sm); direction: rtl; display: inline-block; margin-left: 3px;}
        #results-details .turkish-translation {
            font-size: 1.3rem;
            color: var(--primary-color);
            display: block;
            margin-top: 5px;
            margin-left: 5px;
            font-family: 'Marhey', sans-serif !important;
        }

        .win-buttons { display: flex; gap: 25px; margin-top: 10px; }
        .win-buttons .icon-btn { background-color: transparent; border: none; cursor: pointer; transition: all 0.3s ease; padding: 5px;}
        .win-buttons .icon-btn:hover { transform: scale(1.1); }
        .win-buttons .icon-btn svg { width: 50px; height: 50px; fill: var(--primary-color); }
        .win-buttons .icon-btn:hover svg { fill: var(--accent-color); }

        /* Orientation warning stilleri */
        #orientation-warning { display: none; flex-direction: column; justify-content: center; align-items: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-start); color: var(--text-color); text-align: center; padding: 20px; z-index: 9999; }
        #orientation-warning svg { width: 80px; height: 80px; fill: var(--primary-color); margin-bottom: 20px; animation: rotate-anim 2s infinite ease-in-out; }
        #orientation-warning h2 { font-size: 2rem; }
        @keyframes rotate-anim { 0% { transform: rotate(0deg); } 50% { transform: rotate(-90deg); } 100% { transform: rotate(-90deg); } }
        @keyframes button-glow { 0%, 100% { box-shadow: 0 0 8px rgba(45, 220, 115, 0.5); } 50% { box-shadow: 0 0 20px rgba(45, 220, 115, 0.8); } }

        /* Media Queries */
         @media (max-height: 600px) and (orientation: landscape){
             #typing-screen { justify-content: center; }
             #virtual-keyboard { max-width: 700px; }
             .keyboard-key { font-size: clamp(1rem, 2.5vw, 1.6rem); padding: clamp(4px, 1.2vh, 8px) clamp(2px, 0.8vw, 5px);}
         }
         @media (max-height: 500px) and (orientation: landscape){
            #typing-screen { justify-content: flex-start; padding: 5px; gap: 5px;}
             #typing-main-container { gap: 5px;}
             #typing-game-area { gap: 5px;}
             #typing-interactive-elements { gap: 5px; margin-top: 5px;}
            .typing-stats { font-size: 1rem; gap: 8px;}
            .stat-item { padding: 3px 6px; gap: 4px; }
            .stat-item svg { width: 18px; height: 18px;}
            .word-progress-bar {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: minmax(0, 1fr);
            column-gap: 10px;
            width: 100%;
            max-width: 800px;
            padding: 5px 10px;
            justify-content: stretch;
            direction: rtl;
            margin-bottom: 10px;
            flex-shrink: 0;
            border-radius: var(--border-radius-sm);
            background-color: rgba(0,0,0,0.02);
        }
            .word-progress-item { font-size: 1rem; padding: 2px 4px; }
            #typing-prompt { font-size: clamp(1.8rem, 5vw, 3rem); min-height: 60px; padding: 5px;}
            #typing-input { font-size: 1.4rem; padding: 6px; }
            #typing-submit-btn { width: 50px; }
            #typing-submit-btn svg { width: 20px; height: 20px; }
            #virtual-keyboard { gap: 3px; padding: 4px; border-radius: var(--border-radius-sm); margin-top: 5px;}
            .keyboard-row { gap: 3px; }
            .keyboard-key { font-size: clamp(0.9rem, 2vw, 1.3rem); padding: clamp(3px, 1vh, 6px) clamp(2px, 0.8vw, 4px); min-height: 25px;}
            .keyboard-key svg { width: clamp(14px, 2.5vw, 18px); height: clamp(14px, 2.5vw, 18px);}
         }
        @media (max-width: 600px) {
            .start-title { font-size: 2rem; }
            .difficulty-button { font-size: 1.1rem; padding: 12px 15px;}
            #start-game-btn { font-size: 1.4rem; padding: 10px 20px;}
            #typing-screen { gap: 10px; padding: 10px; justify-content: flex-start; }
             #typing-main-container { gap: 10px;}
             #typing-game-area { gap: 10px; justify-content: flex-start; }
            #typing-interactive-elements { gap: 10px; margin-top: 5px;}
            .typing-stats { font-size: 1.3rem; gap: 10px;}
            .stat-item { padding: 5px 10px; gap: 5px; }
            .stat-item svg { width: 24px; height: 24px; }
            .word-progress-item { font-size: 1rem; }
            #typing-prompt { font-size: clamp(2rem, 6vw, 3.5rem); min-height: 100px; }
            #typing-input { font-size: 1.8rem; padding: 10px; }
            #typing-submit-btn { width: 70px; }
            #typing-submit-btn svg { width: 28px; height: 28px; }
            #virtual-keyboard { gap: 5px; padding: 8px; border-radius: var(--border-radius-sm); margin-top: 10px;}
            .keyboard-row { gap: 5px; }
            .keyboard-key { font-size: clamp(1.1rem, 3vw, 1.6rem); padding: clamp(5px, 1.2vh, 9px) clamp(3px, 1vw, 5px); min-height: 35px;}
            .keyboard-key svg { width: clamp(17px, 3.5vw, 21px); height: clamp(17px, 3.5vw, 21px);}
            .results-screen h2 { font-size: 2rem; }
            .results-stats { font-size: 1.1rem; gap: 10px; }
            #results-details { padding: 15px; max-height: 35vh;}
            #results-details h3 { font-size: 1.5rem; }
            #results-details li { font-size: 1.4rem; }
            .win-buttons { gap: 20px; }
            .win-buttons .icon-btn svg { width: 44px; height: 44px; }
        }

        /* Font Aileleri */
        html, body { font-family: 'Marhey', sans-serif !important; }
        #typing-prompt, .status-word, .keyboard-key, #results-details .prompt, #results-details .user-answer, #results-details .correct-answer, .word-progress-item, #typing-input {
            font-family: 'Harmattan', sans-serif !important;
        }
        button, .start-title, h2, h3, label, .stat-item span, .results-stats, .progress-label, #results-details .turkish-translation {
            font-family: 'Marhey', sans-serif !important;
        }


@media (max-width: 600px){
  .word-progress-bar{
    grid-auto-flow: column;
    grid-auto-columns: minmax(0,1fr);
    column-gap: 8px;
    width: 100%;
  }
  .word-progress-item{
    font-size: clamp(0.9rem, 3.5vw, 1.1rem);
    justify-self: center;
  }
}


/* Mobile: keep disabled input visually normal */
@media (hover: none) and (pointer: coarse){
  #typing-input:disabled {
    background: var(--surface-color);
    color: var(--text-color);
    opacity: 1;
    cursor: default;
    -webkit-text-fill-color: var(--text-color);
  }
  #typing-input { caret-color: transparent; }
}


/* Proxy display for mobile (prevents OS keyboard by hiding the actual input) */
.typing-input-proxy{
  display:none;
  font-size: 2rem;
  padding: 12px;
  border-radius: var(--border-radius-md);
  border: 2px solid #d8dee9;
  background: var(--surface-color);
  color: var(--text-color);
  text-align: right;
  direction: rtl;
  min-height: 56px;
  box-shadow: 0 0 0 3px rgba(94, 129, 172, 0); /* no focus ring */
  font-family: 'Harmattan', sans-serif !important;
  white-space: pre-wrap;
  word-break: break-word;
}
@media (hover:none) and (pointer:coarse){
  #typing-input{ display:none !important; }
  .typing-input-proxy{ display:block; }
}


/* Re-enable real input visibility; prevent taps from focusing it on mobile */
@media (hover:none) and (pointer:coarse){
  #typing-input{ 
    display:block !important; 
    pointer-events:none;       /* taps won't focus => OSK açılmaz */
    caret-color: transparent; 
  }
  .typing-input-proxy{ display:none !important; } /* varsa gizle */
}

</style>
</head>
<body>
<div id="game-wrapper">
    <div class="screen active" id="start-screen">
        <h1 class="start-title">Arapça Klavye Oyunu</h1>
        <div class="difficulty-options">
            <button class="difficulty-button" data-difficulty="easy">Kolay (2dk)</button>
            <button class="difficulty-button" data-difficulty="medium">Orta (1dk 30sn)</button>
            <button class="difficulty-button" data-difficulty="hard">Zor (1dk)</button>
        </div>
        <button disabled id="start-game-btn">Başla</button>
    </div>

    <div class="screen" id="typing-screen"></div>

    <div class="screen results-screen" id="results-screen"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {

    // --- DATA MODULE ---
    const Data = {
         grade9: { title: "Seviye 1", words: { unit1: { title: { tr: "1. Ünite" }, description: { tr: "Selamlaşma ve Tanışma" }, lessons: { lesson1: { description: { tr: "Selamlaşma" }, words: [ { id: 1, arabic: 'السَّلام عَلَيْكُمْ', turkish: 'Selam üzerinize olsun!' }, { id: 2, arabic: 'وَعَلَيْكُم السَّلام', turkish: 'Selam sizin de üzerinize olsun!' }, { id: 3, arabic: 'صَباح الخَيْر', turkish: 'Hayırlı Sabahlar' }, { id: 4, arabic: 'صَباح النّور', turkish: 'Günaydın' }, { id: 5, arabic: 'مَساء الخَيْر', turkish: 'İyi akşamlar' }, { id: 6, arabic: 'مَساء النّور', turkish: 'İyi akşamlar (cevap)' }, { id: 7, arabic: 'مَرْحَبًا', turkish: 'Merhaba!' }, { id: 8, arabic: 'أَهْلًا وَسَهْلًا', turkish: 'Hoş geldiniz!' }, { id: 9, arabic: 'أَهْلًا بِك', turkish: 'Hoş bulduk!' }, { id: 10, arabic: 'كَيْفَ حالُك؟', turkish: 'Nasılsın?' }, { id: 11, arabic: 'أَنا بِخَيْر', turkish: 'İyiyim‫!‬' }, { id: 12, arabic: 'إِلى اللِّقاء', turkish: 'Görüşmek üzere!' }, { id: 13, arabic: 'مَع السَّلامَة', turkish: 'Hoşça kal' }, { id: 14, arabic: 'في أَمان الّٰلهِ', turkish: 'Allah’a emanet ol' }, { id: 15, arabic: 'اِقْرَأْ', turkish: 'Oku!' }, { id: 16, arabic: 'اُكْتُبْ', turkish: 'Yaz!' }, { id: 17, arabic: 'أَعِدْ', turkish: 'Tekrar et!' }, { id: 18, arabic: 'اِسْتَمِعْ', turkish: 'Dinle!' } ] }, lesson2: { description: { tr: "Tanışma" }, words: [ { id: 19, arabic: 'طالِب', turkish: 'Erkek öğrenci' }, { id: 20, arabic: 'مُدَرِّس', turkish: 'Erkek öğretmen' }, { id: 21, arabic: 'صَديق', turkish: 'Erkek arkadaş' }, { id: 22, arabic: 'هُوَ', turkish: 'O (erkek)' }, { id: 23, arabic: 'هِيَ', turkish: 'O (kadın)' }, { id: 24, arabic: 'أَنْتَ', turkish: 'Sen (erkek)' }, { id: 25, arabic: 'أَنا', turkish: 'Ben' }, { id: 26, arabic: 'ما اسْمُك؟', turkish: 'Adın ne?' }, { id: 27, arabic: 'اِسْمي', turkish: 'Benim adım' }, { id: 28, arabic: 'مِن أَيْن؟', turkish: 'Nereli?' }, { id: 29, arabic: 'نَعَم', turkish: 'Evet' }, { id: 30, arabic: 'لا', turkish: 'Hayır' }, { id: 31, arabic: 'تَكَلَّمْ', turkish: 'Konuş' }, { id: 32, arabic: 'اُسْكُتْ', turkish: 'Sus' }, { id: 33, arabic: 'تَعالَ', turkish: 'Gel' }, { id: 34, arabic: 'اِذْهَبْ', turkish: 'Git' }, { id: 35, arabic: 'تَشَرَّفْتُ', turkish: 'Tanıştığıma memnun oldum' }, { id: 36, arabic: 'فُرْصَة سَعيدَة', turkish: 'Memnun oldum' }, { id: 37, arabic: 'شُكْرًا', turkish: 'Teşekkür ederim' }, { id: 38, arabic: 'عَفْوًا', turkish: 'Rica ederim' } ] } } }, unit2: { title: { tr: "2. Ünite" }, description: { tr: "Okulda" }, lessons: { lesson1: { description: { tr: "Sınıf Eşyaları" }, words: [ { id: 101, arabic: 'مَدْرَسَة', turkish: 'Okul' }, { id: 102, arabic: 'صَفّ', turkish: 'Sınıf' }, { id: 103, arabic: 'كِتاب', turkish: 'Kitap' }, { id: 104, arabic: 'دَفْتَر', turkish: 'Defter' }, { id: 105, arabic: 'قَلَم', turkish: 'Kalem' }, { id: 106, arabic: 'سَبّورة', turkish: 'Tahta' }, { id: 107, arabic: 'كُرْسِيّ', turkish: 'Sandalye' }, { id: 108, arabic: 'مَكْتَب', turkish: 'Masa' }, { id: 109, arabic: 'مِمْحاة', turkish: 'Silgi' }, { id: 110, arabic: 'مِسْطَرَة', turkish: 'Cetvel' }, { id: 111, arabic: 'حَقيبَة', turkish: 'Çanta' }, { id: 112, arabic: 'باب', turkish: 'Kapı' }, { id: 113, arabic: 'نافِذَة', turkish: 'Pencere' } ] }, lesson2: { description: { tr: "Yönler ve Eylemler" }, words: [ { id: 114, arabic: 'أَيْن؟', turkish: 'Nerede?' }, { id: 115, arabic: 'هُنا', turkish: 'Burada' }, { id: 116, arabic: 'هُناك', turkish: 'Orada' }, { id: 117, arabic: 'عَلى', turkish: 'Üstünde' }, { id: 118, arabic: 'تَحْت', turkish: 'Altında' }, { id: 119, arabic: 'أَمام', turkish: 'Önünde' }, { id: 120, arabic: 'خَلْف', turkish: 'Arkasında' }, { id: 121, arabic: 'فَوْق', turkish: 'Üzerinde' }, { id: 122, arabic: 'جَانِب', turkish: 'Yanında' }, { id: 123, arabic: 'فِي', turkish: 'İçinde' }, { id: 124, arabic: 'خَارِج', turkish: 'Dışında' }, { id: 125, arabic: 'اِفْتَح', turkish: 'Kitabı aç' }, { id: 126, arabic: 'اِجْلِسْ', turkish: 'Otur' }, { id: 127, arabic: 'اُدْخُلِ الصَّفَّ', turkish: 'Sınıfa gir' } ] } } }, unit3: { title: { tr: "3. Ünite" }, description: { tr: "Evde" }, lessons: { lesson1: { description: { tr: "Evdeyim" }, words: [ { id: 201, arabic: 'بَيْت', turkish: 'Ev' }, { id: 202, arabic: 'غُرْفَة', turkish: 'Oda' }, { id: 203, arabic: 'غُرْفَة النَّوْم', turkish: 'Yatak odası' }, { id: 204, arabic: 'غُرْفَة جُلوس', turkish: 'Oturma odası' }, { id: 205, arabic: 'مَطْبَخ', turkish: 'Mutfak' }, { id: 206, arabic: 'حَمّام', turkish: 'Banyo' }, { id: 207, arabic: 'سَرير', turkish: 'Yatak' }, { id: 208, arabic: 'طاوِلَة', turkish: 'Masa' }, { id: 209, arabic: 'كُرْسِيّ', turkish: 'Sandalye' }, { id: 210, arabic: 'تِلْفاز', turkish: 'Televizyon' }, { id: 211, arabic: 'ثَلّاجة', turkish: 'Buzdolabı' }, { id: 212, arabic: 'فُرْن', turkish: 'Fırın' }, { id: 213, arabic: 'سَجّادَة', turkish: 'Halı' }, { id: 214, arabic: 'هَاتِف', turkish: 'Telefon' }, { id: 215, arabic: 'مِصْباح', turkish: 'Lamba' } ] }, lesson2: { description: { tr: "Odamda" }, words: [ { id: 216, arabic: 'غُرْفَتي', turkish: 'Odam' }, { id: 217, arabic: 'سَرير', turkish: 'Yatak' }, { id: 218, arabic: 'مَكْتَب', turkish: 'Çalışma masası' }, { id: 219, arabic: 'كُرْسِيّ', turkish: 'Sandalye' }, { id: 220, arabic: 'سِتارَة', turkish: 'Perde' }, { id: 221, arabic: 'مِصْباح', turkish: 'Lamba' }, { id: 222, arabic: 'مِرْآة', turkish: 'Ayna' }, { id: 223, arabic: 'سَجّادَة', turkish: 'Halı' }, { id: 224, arabic: 'دُولاب', turkish: 'Dolap' }, { id: 225, arabic: 'نَظيف', turkish: 'Temiz' }, { id: 226, arabic: 'مُرَتَّب', turkish: 'Düzenli' }, { id: 227, arabic: 'وَسِخ', turkish: 'Kirli' }, { id: 228, arabic: 'يُنَظِّفُ', turkish: 'Temizliyor' }, { id: 229, arabic: 'يُرَتِّبُ', turkish: 'Düzenliyor' } ] } } }, unit4: { title: { tr: "4. Ünite" }, description: { tr: "Bir Günüm" }, lessons: { lesson1: { description: { tr: "Bir Günüm" }, words: [ { id: 301, arabic: 'صَباح', turkish: 'Sabah' }, { id: 302, arabic: 'ظُهْر', turkish: 'Öğle' }, { id: 303, arabic: 'مَساء', turkish: 'Akşam' }, { id: 304, arabic: 'لَيْل', turkish: 'Gece' }, { id: 305, arabic: 'يَسْتَيْقِظُ', turkish: 'Uyanıyor' }, { id: 306, arabic: 'يَغْسِلُ وَجْهَهُ', turkish: 'Yüzünü yıkıyor' }, { id: 307, arabic: 'يُصَلّي', turkish: 'Namaz kılıyor' }, { id: 308, arabic: 'يَلْبَسُ مَلابِسَهُ', turkish: 'Giyiniyor' }, { id: 309, arabic: 'يَتَناوَلُ الفَطور', turkish: 'Kahvaltı yapıyor' }, { id: 310, arabic: 'يَذْهَبُ إِلى المَدْرَسَة', turkish: 'Okula gidiyor' }, { id: 311, arabic: 'ُيَدْرُs', turkish: 'Ders çalışıyor' }, { id: 312, arabic: 'يَرْجِعُ إِلى البَيْت', turkish: 'Eve dönüyor' }, { id: 313, arabic: 'يَتَغَدّى', turkish: 'Öğle yemeği yiyor' }, { id: 314, arabic: 'يَسْتَريحُ', turkish: 'Dinleniyor' }, { id: 315, arabic: 'يَلْعَبُ', turkish: 'Oynuyor' } ] }, lesson2: { description: { tr: "Günlük Rutin" }, words: [ { id: 316, arabic: 'أَسْتَيْقِظُ مُبَكِّرًا', turkish: 'Erken uyanıyorum' }, { id: 317, arabic: 'أَذْهَبُ إِلى المَدْرَسَة', turkish: 'Okula gidiyorum' }, { id: 318, arabic: 'أُصَلّي صَلاة الظُّهْر', turkish: 'Öğle namazı kılıyorum' }, { id: 319, arabic: 'أَتَغَدّى مَع أُسْرَتي', turkish: 'Ailemle öğle yemeği yiyorum' }, { id: 320, arabic: 'أَقْرَأُ دُروسي', turkish: 'Derslerimi okuyorum' }, { id: 321, arabic: 'أَكْتُبُ واجِباتي', turkish: 'Ödev yazıyorum' }, { id: 322, arabic: 'أَلْعَبُ في السّاحَة', turkish: 'Bahçede oynuyorum' }, { id: 323, arabic: 'أُساعِدُ أُمّي', turkish: 'Anneme yardım ediyorum' }, { id: 324, arabic: 'أَزورُ جَدِي', turkish: 'Dedemi ziyaret ediyorum' }, { id: 325, arabic: 'أَذْهَبُ إِلى المَسْجِد', turkish: 'Camiye gidiyorum' }, { id: 326, arabic: 'أُرَتِّبُ سَريري', turkish: 'Yatağımı düzeltiyorum' }, { id: 327, arabic: 'أُنَظِّفُ غُرْفَتي', turkish: 'Odamı temizliyorum' }, { id: 328, arabic: 'أُراجِعُ دُروسي', turkish: 'Derslerimi tekrar ediyorum' }, { id: 329, arabic: 'أَنامُ مُتَأَخِّرًا', turkish: 'Geç yatıyorum' } ] } } } } }, grade10: { title: "Seviye 2", words: { unit1: { title: { tr: "1. Ünite" }, description: { tr: "Değerlerim ve Ailem" }, lessons: { lesson1: { description: { tr: "Güzel Davranışlar" }, words: [ { id: 401, arabic: 'صِدْق', turkish: 'Doğruluk' }, { id: 402, arabic: 'أَمانَة', turkish: 'Güvenilirlik' }, { id: 403, arabic: 'إِخْلاص', turkish: 'Samimiyet' }, { id: 404, arabic: 'تَعاوُن', turkish: 'Yardımlaşma' }, { id: 405, arabic: 'اِحْتِرام', turkish: 'Saygı' }, { id: 406, arabic: 'مَحَبَّة', turkish: 'Sevgi' }, { id: 407, arabic: 'شُكْر', turkish: 'Teşekkür' }, { id: 408, arabic: 'الِاعْتِذار', turkish: 'Özür dileme' }, { id: 409, arabic: 'رَحْمَة', turkish: 'Merhamet' }, { id: 410, arabic: 'صَبْر', turkish: 'Sabır' }, { id: 411, arabic: 'عَدْل', turkish: 'Adalet' }, { id: 412, arabic: 'تَواضُع', turkish: 'Alçakgönüllülük' }, { id: 413, arabic: 'يُساعِدُ', turkish: 'Yardım ediyor' }, { id: 414, arabic: 'يُحِبُّ', turkish: 'Seviyor' }, { id: 415, arabic: 'يَبْتَسِمُ', turkish: 'Gülümsüyor' } ] }, lesson2: { description: { tr: "Mutlu Aile" }, words: [ { id: 416, arabic: 'أُسْرَة', turkish: 'Aile' }, { id: 417, arabic: 'أَب', turkish: 'Baba' }, { id: 418, arabic: 'أُمّ', turkish: 'Anne' }, { id: 419, arabic: 'أَخ', turkish: 'Erkek kardeş' }, { id: 420, arabic: 'أُخْت', turkish: 'Kız kardeş' }, { id: 421, arabic: 'جَدّ', turkish: 'Dede' }, { id: 422, arabic: 'جَدَّة', turkish: 'Nine' }, { id: 423, arabic: 'عَمّ', turkish: 'Amca' }, { id: 424, arabic: 'عَمَّة', turkish: 'Hala' }, { id: 425, arabic: 'خَال', turkish: 'Dayı' }, { id: 426, arabic: 'خالَة', turkish: 'Teyze' }, { id: 427, arabic: 'أَقارِب', turkish: 'Akrabalar' }, { id: 428, arabic: 'يَزورُ الأَقارِب', turkish: 'Akrabaları ziyaret ediyor' }, { id: 429, arabic: 'يَحْتَرِمُ الكِبار', turkish: 'Büyüklere saygı gösteriyor' }, { id: 430, arabic: 'يَرْحَمُ الصِّغار', turkish: 'Küçüklere merhamet ediyor' } ] } } }, unit2: { title: { tr: "2. Ünite" }, description: { tr: "Kendimi Keşfediyorum" }, lessons: { lesson1: { description: { tr: "Ben Kimim?" }, words: [ { id: 501, arabic: 'مَن أَنا؟', turkish: 'Ben kimim?' }, { id: 502, arabic: 'اِسْم', turkish: 'İsim' }, { id: 503, arabic: 'عُمْر', turkish: 'Yaş' }, { id: 504, arabic: 'مِهْنَة', turkish: 'Meslek' }, { id: 505, arabic: 'هِوايَة', turkish: 'Hobi' }, { id: 506, arabic: 'مَوْهِبَة', turkish: 'Yetenek' }, { id: 507, arabic: 'طَيِّب', turkish: 'İyi kalpli' }, { id: 508, arabic: 'مُجْتَهِد', turkish: 'Çalışkan' }, { id: 509, arabic: 'كَسول', turkish: 'Tembel' }, { id: 510, arabic: 'هادِئ', turkish: 'Sakin' }, { id: 511, arabic: 'نَشيط', turkish: 'Enerjik' }, { id: 512, arabic: 'مُبْتَسِم', turkish: 'Güleryüzlü' }, { id: 513, arabic: 'صَبور', turkish: 'Sabırlı' }, { id: 514, arabic: 'أَحْلامي', turkish: 'Hayallerim' }, { id: 515, arabic: 'مُسْتَقْبَل', turkish: 'Gelecek' } ] }, lesson2: { description: { tr: "Hobilerim" }, words: [ { id: 516, arabic: 'قِراءَة', turkish: 'Okuma' }, { id: 517, arabic: 'كِتابَة', turkish: 'Yazma' }, { id: 518, arabic: 'رَسْم', turkish: 'Resim yapma' }, { id: 519, arabic: 'طَبْخ', turkish: 'Yemek pişirme' }, { id: 520, arabic: 'تَصْوير', turkish: 'Fotoğrafçılık' }, { id: 521, arabic: 'رِياضَة', turkish: 'Spor' }, { id: 522, arabic: 'كُرَة القَدَم', turkish: 'Futbol' }, { id: 523, arabic: 'كُرَة السَّلَّة', turkish: 'Basketbol' }, { id: 524, arabic: 'سَفَر', turkish: 'Seyahat' }, { id: 525, arabic: 'طَبيعَة', turkish: 'Doğa' }, { id: 526, arabic: 'أَفْلام', turkish: 'Filmler' }, { id: 527, arabic: 'موسيقى', turkish: 'Müzik' }, { id: 528, arabic: 'مَكْتَبَة', turkish: 'Kütüphane' }, { id: 529, arabic: 'في الوَقْت الفارِغ', turkish: 'Boş zamanlarda' }, { id: 530, arabic: 'مُفيد', turkish: 'Faydalı' }, { id: 531, arabic: 'مُمْتِع', turkish: 'Eğlenceli' } ] } } }, unit3: { title: { tr: "3. Ünite" }, description: { tr: "Zaman ve Hayat" }, lessons: { lesson1: { description: { tr: "Zamanım ve Hayatım" }, words: [ { id: 601, arabic: 'وَقْتي', turkish: 'Zamanım' }, { id: 602, arabic: 'حَياتي', turkish: 'Hayatım' }, { id: 603, arabic: 'نَوْم', turkish: 'Uyku' }, { id: 604, arabic: 'عَمَل', turkish: 'Çalışma' }, { id: 605, arabic: 'اِسْتِراحَة', turkish: 'Dinlenme' }, { id: 606, arabic: 'نَهار', turkish: 'Gündüz' }, { id: 607, arabic: 'يُنَظِّمُ', turkish: 'Düzenliyor' }, { id: 608, arabic: 'يُخَطِّطُ', turkish: 'Planlıyor' }, { id: 609, arabic: 'يَدْرُسُ', turkish: 'Ders çalışıyor' }, { id: 610, arabic: 'يَسْتَريحُ', turkish: 'Dinleniyor' }, { id: 611, arabic: 'كُلّ يَوْم', turkish: 'Her gün' }, { id: 612, arabic: 'أَحْيانًا', turkish: 'Bazen' }, { id: 613, arabic: 'نادِرًا', turkish: 'Nadiren' }, { id: 614, arabic: 'دائِمًا', turkish: 'Her zaman' }, { id: 615, arabic: 'نَجاح', turkish: 'Başarı' } ] }, lesson2: { description: { tr: "Zamanımı Değerlendiriyorum" }, words: [ { id: 616, arabic: 'تَّخْطيط', turkish: 'Planlama' }, { id: 617, arabic: 'فَشَل', turkish: 'Başarısızlık' }, { id: 618, arabic: 'جِدّ', turkish: 'Ciddiyet' }, { id: 619, arabic: 'كَسَل', turkish: 'Tembellik' }, { id: 620, arabic: 'حِكْمَة', turkish: 'Bilgelik' }, { id: 621, arabic: 'إِبْداع', turkish: 'Yaratıcılık' }, { id: 622, arabic: 'لا يُؤَجِّلُ', turkish: 'Ertelemiyor' }, { id: 623, arabic: 'يَسْتَغِلُّ الوَقْت', turkish: 'Zamanı değerlendiriyor' }, { id: 624, arabic: 'يُضَيِّعُ الوَقْت', turkish: 'Zamanı boşa harcıyor' }, { id: 625, arabic: 'يَوْم', turkish: 'Gün' }, { id: 626, arabic: 'أُسْبوع', turkish: 'Hafta' }, { id: 627, arabic: 'مُسْتَقْبَل', turkish: 'Gelecek' }, { id: 628, arabic: 'حاضِر', turkish: 'Şimdi' }, { id: 629, arabic: 'مَاضي', turkish: 'Geçmiş' }, { id: 630, arabic: 'تَطْوير النَّفْس', turkish: 'Kendini geliştirme' } ] } } }, unit4: { title: { tr: "4. Ünite" }, description: { tr: "Sağlık ve Beslenme" }, lessons: { lesson1: { description: { tr: "Sağlıklı Yaşam" }, words: [ { id: 701, arabic: 'جِسْم', turkish: 'Vücut' }, { id: 702, arabic: 'عَقْل', turkish: 'Akıl' }, { id: 703, arabic: 'نَظّافَة', turkish: 'Temizlik' }, { id: 704, arabic: 'غِذاء', turkish: 'Beslenme' }, { id: 705, arabic: 'صِحَّة', turkish: 'Sağlık' }, { id: 706, arabic: 'مَرَض', turkish: 'Hastalık' }, { id: 707, arabic: 'طَبيب', turkish: 'Doktor' }, { id: 708, arabic: 'دَواء', turkish: 'İlaç' }, { id: 709, arabic: 'أَسْنان', turkish: 'Dişler' }, { id: 710, arabic: 'النَّظّافَة مِن الإِيمان', turkish: 'Temizlik imandandır' }, { id: 711, arabic: 'يُفَرِّشُ الأَسْnan', turkish: 'Diş fırçalıyor' }, { id: 712, arabic: 'يَسْتَحِمُّ', turkish: 'Banyo yapıyor' }, { id: 713, arabic: 'يَنامُ مُبَكِّرًا', turkish: 'Erken uyuyor' }, { id: 714, arabic: 'صِحِّيّ', turkish: 'Sağlıklı' }, { id: 715, arabic: 'يُمارِسُ الرِّياضَة', turkish: 'Spor yapıyor' } ] }, lesson2: { description: { tr: "Sağlıklı Beslenme" }, words: [ { id: 716, arabic: 'فَواكِه', turkish: 'Meyveler' }, { id: 717, arabic: 'خُضْراوات', turkish: 'Sebzeler' }, { id: 718, arabic: 'لَحْم', turkish: 'Et' }, { id: 719, arabic: 'سَمَك', turkish: 'Balık' }, { id: 720, arabic: 'لَبَن', turkish: 'Süt' }, { id: 721, arabic: 'جُبْن', turkish: 'Peynir' }, { id: 222, arabic: 'بَيْض', turkish: 'Yumurta' }, { id: 723, arabic: 'خُبْز', turkish: 'Ekmek' }, { id: 724, arabic: 'ماء', turkish: 'Su' }, { id: 725, arabic: 'عَصير', turkish: 'Meyve suyu' }, { id: 726, arabic: 'الطَّعام السَّريع', turkish: 'Fast food' }, { id: 727, arabic: 'المَشْروبات الغازِيَة', turkish: 'Gazlı içecekler' }, { id: 728, arabic: 'فَطور', turkish: 'Kahvaltı' }, { id: 729, arabic: 'غَداء', turkish: 'Öğle yemeği' }, { id: 730, arabic: 'عَشاء', turkish: 'Akşam yemeği' } ] } } } } }
    };
    // --- UTILS MODULE (normalizeForTyping güncellendi) ---
    const Utils = {
        shuffleArray: (arr) => [...arr].sort(() => 0.5 - Math.random()),
        stripHarakat: (text) => text.replace(/[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E8\u06EA-\u06ED]/g, '').replace(/[؟?]/g, ''),
        normalizeForTyping: (text) => text
            .replace(/[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E8\u06EA-\u06ED]/g, '')
            .replace(/[أإآ]/g, 'ا') // Hemzeleri 'ا' yap
            .replace(/ى/g, 'ي')
            .replace(/[؟?]/g, '')
    };

    // --- APP MODULE ---
    const App = {
        state: { selectedDifficulty: null, gameSettings: { time: 120, wordCount: 10 }, allWords: [], isAudioInitialized: false, audioCtx: null, },
        dom: {
            screens: document.querySelectorAll('.screen'), startScreen: document.getElementById('start-screen'), typingScreen: document.getElementById('typing-screen'), resultsScreen: document.getElementById('results-screen'),
            difficultyOptions: null, startGameBtn: null,
        },
        init() {
            this.dom.difficultyOptions = document.querySelector('.difficulty-options'); this.dom.startGameBtn = document.getElementById('start-game-btn');
            if (!this.dom.difficultyOptions || !this.dom.startGameBtn) { console.error("Başlangıç ekranı elementleri bulunamadı!"); return; }
            this.initAudio(); this.loadAllWords(); this.initStartScreenListeners(); TypingGame.init(); this.showScreen('start-screen');
        },
        showScreen(screenId) { this.dom.screens.forEach(screen => screen.classList.remove('active')); const targetScreen = document.getElementById(screenId); if (targetScreen) { targetScreen.classList.add('active'); targetScreen.scrollTop = 0; } if (screenId === 'start-screen') { this.resetStartScreen(); } },
        initAudio() { if (this.state.audioCtx && this.state.audioCtx.state === 'running') return; try { if (!this.state.audioCtx) { this.state.audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } if (this.state.audioCtx.state === 'suspended') { this.state.audioCtx.resume().then(() => { this.state.isAudioInitialized = true; }); } else { this.state.isAudioInitialized = true; } } catch (e) { console.error("Web Audio API desteklenmiyor."); this.state.isAudioInitialized = false; } },
        playSound(soundKey) { if (!this.state.isAudioInitialized || !this.state.audioCtx || this.state.audioCtx.state !== 'running') return; const sounds = { flip: { f: 200, t: 'triangle', d: 0.1 }, match: { f: 440, t: 'sine', d: 0.2 }, menuClick: { f: 600, t: 'square', d: 0.08 }, touch: { f: 300, t: 'sine', d: 0.05 }, correct: { f: 523.25, t: 'sine', d: 0.2 }, incorrect: { f: 164.81, t: 'square', d: 0.2 }, countdown: { f: 880, t: 'sine', d: 0.15 } }; const sound = sounds[soundKey]; if (!sound) return; const g = this.state.audioCtx.createGain(); g.connect(this.state.audioCtx.destination); g.gain.setValueAtTime(0, this.state.audioCtx.currentTime); g.gain.linearRampToValueAtTime(0.1, this.state.audioCtx.currentTime + 0.01); g.gain.linearRampToValueAtTime(0, this.state.audioCtx.currentTime + sound.d); const o = this.state.audioCtx.createOscillator(); o.type = sound.t; o.frequency.value = sound.f; o.connect(g); o.start(0); o.stop(this.state.audioCtx.currentTime + sound.d); },
        loadAllWords() { this.state.allWords = Object.values(Data).flatMap(grade => Object.values(grade.words).flatMap(unit => Object.values(unit.lessons).flatMap(lesson => lesson.words || []))).filter(word => word && word.arabic && !word.arabic.includes(' ')); console.log(`Toplam ${this.state.allWords.length} adet boşluksuz kelime yüklendi.`); },
        initStartScreenListeners() {
            if (this.dom.difficultyOptions) {
                this.dom.difficultyOptions.addEventListener('click', (e) => {
                    const button = e.target.closest('.difficulty-button');
                    if (!button) return;
                    console.log("Difficulty button clicked:", button.dataset.difficulty); this.playSound('menuClick');
                    this.state.selectedDifficulty = button.dataset.difficulty; this.updateSelection(this.dom.difficultyOptions, button);
                    switch (this.state.selectedDifficulty) {
                        case 'easy': this.state.gameSettings = { time: 120, wordCount: 10 }; break;
                        case 'medium': this.state.gameSettings = { time: 90, wordCount: 10 }; break;
                        case 'hard': this.state.gameSettings = { time: 60, wordCount: 10 }; break;
                        default: this.state.gameSettings = { time: 120, wordCount: 10 };
                    }
                    console.log("Selected difficulty:", this.state.selectedDifficulty, "Settings:", this.state.gameSettings); this.checkStartButtonState();
                });
            } else { console.error("Zorluk seçenekleri konteyneri bulunamadı!"); }
            if (this.dom.startGameBtn) {
                this.dom.startGameBtn.onclick = () => {
                    console.log("Start game button clicked"); App.playSound('menuClick');
                    if (!App.state.selectedDifficulty) return;
                    const wordsForGame = Utils.shuffleArray(App.state.allWords).slice(0, App.state.gameSettings.wordCount);
                    if (wordsForGame.length < App.state.gameSettings.wordCount) { alert(`Yeterli kelime bulunamadı (${wordsForGame.length}/${App.state.gameSettings.wordCount}). Lütfen daha fazla kelime ekleyin.`); return; }
                    TypingGame.start(wordsForGame, App.state.gameSettings); App.showScreen('typing-screen');
                };
            } else { console.error("Başla butonu bulunamadı!"); }
        },
        updateSelection(container, selectedButton) { if (!container) return; container.querySelectorAll('.selected').forEach(btn => btn.classList.remove('selected')); if (selectedButton) { selectedButton.classList.add('selected'); console.log("Applied 'selected' class to:", selectedButton.dataset.difficulty || 'button'); } },
        checkStartButtonState() { if (!this.dom.startGameBtn) return; this.dom.startGameBtn.disabled = !this.state.selectedDifficulty; console.log("Start button disabled:", this.dom.startGameBtn.disabled); },
        resetStartScreen() { this.state.selectedDifficulty = null; this.updateSelection(this.dom.difficultyOptions, null); this.checkStartButtonState(); TypingGame.stop(); },
        showResults(score, mistakes, accuracy, wpm, timeTaken) {
             const resultsScreen = document.getElementById('results-screen');
             resultsScreen.innerHTML = `
                 <div class="header-navigation"><button class="back-btn" title="Yeni Zorluk Seç"><svg viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"></path></svg></button></div>
                 <h2 id="results-title">Oyun Bitti!</h2>
                 <div class="results-stats">
                     <div class="results-stat-item">Skor: <strong id="results-score">${Math.round(score)}</strong></div>
                     <div class="results-stat-item">Doğruluk: <strong id="results-accuracy">${accuracy}%</strong></div>
                     <div class="results-stat-item">Dakikadaki Kelime Sayısı: <strong id="results-wpm">${wpm}</strong></div>
                     <div class="results-stat-item">Süre: <strong id="results-time">${Math.floor(timeTaken / 60)}dk ${timeTaken % 60}sn</strong></div>
                 </div>
                 <div id="results-details">
                     ${mistakes.length > 0 ? '<h3>Yanlış Yazılanlar:</h3>' : '<h3>Tebrikler! Hiç hatanız yok!</h3>'}
                     ${mistakes.length > 0 ? `<ul>${mistakes.map(m => `<li>
                        <div><span class="prompt">${m.prompt}:</span> <span class="user-answer">${m.incorrect}</span> ➜ <span class="correct-answer">${m.correct}</span></div>
                        <div class="turkish-translation">(Anlamı: ${m.turkish})</div>
                     </li>`).join('')}</ul>` : ''}
                 </div>
                 <div class="win-buttons">
                     <button class="icon-btn" id="play-again-btn" title="Tekrar Oyna (Aynı Zorluk)"><svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path></svg></button>
                     <button class="icon-btn" id="change-difficulty-btn" title="Yeni Zorluk Seç"><svg viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"></path></svg></button>
                 </div>
             `;
              resultsScreen.querySelector('.back-btn').onclick = () => { App.playSound('menuClick'); App.showScreen('start-screen'); };
              document.getElementById('play-again-btn').onclick = () => { App.playSound('menuClick'); const wordsForGame = Utils.shuffleArray(this.state.allWords).slice(0, this.state.gameSettings.wordCount); if (wordsForGame.length < this.state.gameSettings.wordCount) { alert("Yeterli kelime bulunamadı."); return; } TypingGame.start(wordsForGame, this.state.gameSettings); App.showScreen('typing-screen'); };
              document.getElementById('change-difficulty-btn').onclick = () => { App.playSound('menuClick'); App.showScreen('start-screen'); };
             this.showScreen('results-screen');
         }
    };

    // --- TYPING GAME MODULE ---
    const TypingGame = {
        screenId: 'typing-screen',
        state: { words: [], currentIndex: 0, score: 0, timeLeft: 120, timer: null, mistakes: [], nextWordTimeout: null, totalCharsInRound: 0, correctChars: 0, totalTypedChars: 0, startTime: null, endTime: null },
        dom: {},
        init() { /* Listenerlar start içinde eklenecek */ },
        start(words, settings) {
             this.state = { words: words, currentIndex: 0, score: 0, timeLeft: settings.time, timer: null, mistakes: [], nextWordTimeout: null, totalCharsInRound: words.reduce((acc, word) => acc + Utils.normalizeForTyping(word.arabic).length, 0) || 1, correctChars: 0, totalTypedChars: 0, startTime: null, endTime: null };
            const typingScreen = document.getElementById('typing-screen');
            typingScreen.innerHTML = `
                <div class="header-navigation"><button class="back-btn" title="Zorluk Seçimine Dön"><svg viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"></path></svg></button></div>
                <div id="typing-main-container"> <div id="typing-game-area"> <div id="typing-interactive-elements">
                    <div class="typing-stats">
                         <div class="stat-item" id="score-stat-item"> <div class="score-effects-container-typing"></div> <svg viewBox="0 0 24 24"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"></path></svg> <span id="score-value">0</span> </div>
                         <div class="stat-item" id="timer-stat-item"> <svg viewBox="0 0 24 24"><path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"></path></svg> <span id="timer-value">00:00</span> </div>
                    </div>
                    <div class="progress-container">
                        <div class="word-progress-bar" id="typing-progress-bar"></div>
                    </div>
                    <div id="typing-prompt">Kelime Yükleniyor...</div>
                    <div class="typing-input-area"> <input inputmode="none" autocomplete="off" id="typing-input" readonly spellcheck="false" type="text"/ tabindex="-1">
                    <div id="typing-input-proxy" class="typing-input-proxy" aria-hidden="false"></div> <button id="typing-submit-btn"><svg viewBox="0 0 24 24"><path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"></path></svg></button> </div>
                </div> <div id="virtual-keyboard"></div> </div> </div> <div class="countdown-overlay" id="countdown-overlay"></div>`;
            // --- Virtual Keyboard: single-handler, no-duplicate, pointer-based ---
            (function(){
              const inputEl = document.getElementById('typing-input');
              const vk = document.getElementById('virtual-keyboard');
              if (!inputEl || !vk) return;

              // Block other handlers on keys (capture) to avoid duplicates
              const blocker = (e) => {
                const key = e.target.closest && e.target.closest('.keyboard-key');
                if (!key) return;
                e.preventDefault();
                e.stopImmediatePropagation();
                e.stopPropagation();
              };
              ['click','touchstart'].forEach(evt => {
                vk.addEventListener(evt, blocker, { capture: true, passive: false });
              });

              let lastStamp = -1;
              const fireInput = () => {
                const ev = new Event('input', { bubbles: true });
                inputEl.dispatchEvent(ev);
              };
              const appendChar = (ch) => {
                inputEl.value = (inputEl.value || '') + ch;
                fireInput();
              };
              const backspace = () => {
                inputEl.value = (inputEl.value || '').slice(0, -1);
                fireInput();
              };
              const insertSpace = () => appendChar(' ');

              vk.addEventListener('pointerdown', (e) => {
                const key = e.target.closest('.keyboard-key');
                if (!key) return;
                if (e.timeStamp === lastStamp) return; // guard
                lastStamp = e.timeStamp;
                e.preventDefault();

                if (key.classList.contains('backspace')) { backspace(); return; }
                if (key.classList.contains('space-bar')) { insertSpace(); return; }

                // Prefer data-key
                let ch = key.getAttribute('data-key');
                if (!ch) {
                  // Try textContent, stripping whitespace/newlines/icons
                  ch = (key.textContent || '').replace(/\s+/g, ' ').trim();
                }
                if (!ch) return;
                appendChar(ch);
              }, { passive: false });
            })();

            // --- Virtual Keyboard Bridge: write to input without focusing it; fire 'input' events ---
            (function(){
              const inputEl = document.getElementById('typing-input');
              const vk = document.getElementById('virtual-keyboard');
              if (!inputEl || !vk) return;

              const appendChar = (ch) => {
                const v = (inputEl.value || '') + ch;
                inputEl.value = v;
                // fire input event so any listeners react
                const ev = new Event('input', { bubbles: true });
                inputEl.dispatchEvent(ev);
              };
              const backspace = () => {
                const v = (inputEl.value || '');
                inputEl.value = v.slice(0, -1);
                const ev = new Event('input', { bubbles: true });
                inputEl.dispatchEvent(ev);
              };
              const insertSpace = () => appendChar(' ');

              vk.addEventListener('click', (e) => {
                const key = e.target.closest('.keyboard-key');
                if (!key) return;
                e.preventDefault();
                if (key.classList.contains('backspace')) { backspace(); return; }
                if (key.classList.contains('space-bar')) { insertSpace(); return; }
                // Prefer data-key attribute; fallback to textContent
                const ch = key.getAttribute('data-key') || key.textContent.trim();
                if (!ch) return;
                appendChar(ch);
              }, { passive: false });
            })();

            // --- Mobile Input Bridge: keep real input hidden; mirror to proxy; block any OSK ---
            (function(){
              const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
              const inputEl = document.getElementById('typing-input');
              const proxyEl = document.getElementById('typing-input-proxy');
              if (!inputEl || !proxyEl) return;
              if (!isMobile) { proxyEl.style.display = 'none'; return; }

              // Ensure the hidden input cannot trigger OSK
              try{
                inputEl.disabled = true;
                inputEl.setAttribute('readonly','');
                inputEl.setAttribute('inputmode','none');
                inputEl.setAttribute('tabindex','-1');
                inputEl.setAttribute('aria-hidden','true');
                inputEl.blur();
              }catch(e){}

              // Show proxy, prevent selecting/tapping that could trigger selection UI
              proxyEl.addEventListener('touchstart', e => e.preventDefault(), {passive:false});
              proxyEl.addEventListener('mousedown', e => e.preventDefault());
              proxyEl.addEventListener('click', e => e.preventDefault());

              // Mirror mechanics: redefine value property on the specific input element
              let store = '';
              Object.defineProperty(inputEl, 'value', {
                configurable: true,
                get(){ return store; },
                set(v){
                  store = (v==null? '' : String(v));
                  proxyEl.textContent = store;
                }
              });

              // Expose simple helpers on the element (some code may call inputEl.value=... or += etc.)
              inputEl.setValue = (v)=>{ inputEl.value = v; };
              inputEl.appendChar = (ch)=>{ inputEl.value = (inputEl.value || '') + ch; };
              inputEl.clearValue = ()=>{ inputEl.value = ''; };

              // Keep caret illusion off
              proxyEl.style.caretColor = 'transparent';

              // If any code tries to focus the input, swallow it
              const of = HTMLElement.prototype.focus;
              HTMLElement.prototype.focus = function(...args){
                 if (this === inputEl) { try{ this.blur(); }catch(e){} return; }
                 return of.apply(this, args);
              };
            })();

            // --- Start prompt visual direction control ---
            (function(){
                const promptEl = document.getElementById('typing-prompt');
                if (!promptEl) return;
                const applyStartModeDir = () => {
                    if (promptEl.classList.contains('start-mode')) {
                        // Show 'Hazır' with LTR so '!' stays on the right visually
                        promptEl.textContent = 'Hazır';
                        promptEl.setAttribute('dir','ltr');
                    }
                };
                applyStartModeDir();
                // Observe class changes to flip dir appropriately
                const observer = new MutationObserver(() => {
                    if (!promptEl.classList.contains('start-mode')) {
                        promptEl.setAttribute('dir','rtl');
                    } else {
                        applyStartModeDir();
                    }
                });
                observer.observe(promptEl, { attributes: true, attributeFilter: ['class'] });
            })();

            this.dom = { timer: document.getElementById('timer-value'), score: document.getElementById('score-value'), prompt: document.getElementById('typing-prompt'), input: document.getElementById('typing-input'), submit: document.getElementById('typing-submit-btn'), progressBar: document.getElementById('typing-progress-bar'), keyboard: document.getElementById('virtual-keyboard'), countdownOverlay: document.getElementById('countdown-overlay'), effectsContainer: typingScreen.querySelector('.score-effects-container-typing') };
            typingScreen.querySelector('.back-btn').onclick = () => { App.playSound('menuClick'); App.showScreen('start-screen'); this.stop(); };
            this.dom.input.onkeydown = e => { if (e.key === 'Enter') { e.preventDefault(); this.checkAnswer(); } }; this.dom.submit.onclick = () => this.checkAnswer();
            this.dom.score.textContent = '0'; this.updateTimerDisplay();
            this.dom.prompt.textContent = 'Hazır'; this.dom.prompt.className = 'start-mode'; this.dom.prompt.onclick = () => this.handleStartClick();
            this.dom.input.disabled = true; this.dom.input.readOnly = true; this.dom.input.value = ''; this.createKeyboard(); this.createWordProgressBar();
        },
        handleStartClick() { if (this.dom.prompt?.classList.contains('start-mode')) { App.playSound('menuClick'); this.dom.prompt.classList.remove('start-mode'); this.dom.prompt.onclick = null; this.startCountdown(); } },
        stop() { if (this.state.timer) clearInterval(this.state.timer); this.state.timer = null; if (this.state.nextWordTimeout) clearTimeout(this.state.nextWordTimeout); this.state.nextWordTimeout = null; },
        startCountdown() { if(!this.dom.countdownOverlay) return; this.dom.countdownOverlay.style.display = 'flex'; let count = 3; this.dom.countdownOverlay.textContent = count; App.playSound('countdown'); if(this.dom.prompt) this.dom.prompt.textContent = ''; const countdownInterval = setInterval(() => { count--; if (count > 0) { if(this.dom.countdownOverlay) this.dom.countdownOverlay.textContent = count; App.playSound('countdown'); } else { clearInterval(countdownInterval); if(this.dom.countdownOverlay) this.dom.countdownOverlay.style.display = 'none'; this.startGameLoop(); } }, 1000); },
        startGameLoop() { if(!this.dom.input) return; this.state.startTime = Date.now(); this.dom.input.disabled = false; this.dom.input.readOnly = false; try { this.dom.input.focus(); } catch(e) { console.warn("Input focus failed:", e); } this.showNextWord(); if(this.state.timer === null) { this.state.timer = setInterval(() => { this.state.timeLeft--; this.updateTimerDisplay(); if (this.state.timeLeft <= 0) { this.endGame(); } }, 1000); } },
        createWordProgressBar() {
            if(!this.dom.progressBar || !this.state.words) return;
            this.dom.progressBar.innerHTML = '';
            this.state.words.forEach((word, index) => {
                const wordEl = document.createElement('span');
                wordEl.className = 'word-progress-item';
                wordEl.textContent = Utils.stripHarakat(word.arabic);
                wordEl.dataset.index = index;
                this.dom.progressBar.appendChild(wordEl);
            });
        },
        showNextWord() {
             if(!this.dom.prompt || !this.dom.input || !this.dom.progressBar || !this.state.words) return;
             if (this.state.currentIndex >= this.state.words.length) { this.endGame(); return; }
             const word = this.state.words[this.state.currentIndex];
             this.dom.prompt.textContent = Utils.stripHarakat(word.arabic);
             this.dom.input.value = ''; this.dom.input.className = '';
             if (!this.dom.input.disabled) { try { this.dom.input.focus(); } catch(e) {} }
             const wordItems = this.dom.progressBar.children;
             Array.from(wordItems).forEach(item => item.classList.remove('active'));
             if (wordItems[this.state.currentIndex]) {
                 wordItems[this.state.currentIndex].classList.add('active');
                  wordItems[this.state.currentIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
             }
         },
        updateTimerDisplay() { if(!this.dom.timer) return; const minutes = Math.floor(Math.max(0, this.state.timeLeft) / 60); const seconds = Math.max(0, this.state.timeLeft) % 60; this.dom.timer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`; },
        checkAnswer() {
            if (!this.dom.input || !this.dom.progressBar || !this.state.words) return;
            const userAnswer = this.dom.input.value.trim();
            if (userAnswer === '' || this.dom.input.disabled || this.state.currentIndex >= this.state.words.length) return;
            this.dom.input.disabled = true;
            const word = this.state.words[this.state.currentIndex];
            const normalizedCorrect = Utils.normalizeForTyping(word.arabic);
            const normalizedUser = Utils.normalizeForTyping(userAnswer);
            const isCorrect = normalizedUser === normalizedCorrect;
            this.state.totalTypedChars += normalizedUser.length;
             const wordItems = this.dom.progressBar.children;
             if (wordItems[this.state.currentIndex]) {
                 wordItems[this.state.currentIndex].classList.remove('active');
                 wordItems[this.state.currentIndex].classList.add(isCorrect ? 'correct' : 'incorrect');
             }
            if (isCorrect) {
                App.playSound('correct'); const wordChars = normalizedCorrect.length; this.state.correctChars += wordChars; let points = (wordChars / this.state.totalCharsInRound) * 100; this.state.score += points; this.showScoreEffect(Math.round(points)); if(this.dom.score) this.dom.score.textContent = Math.round(this.state.score);
                this.dom.input.classList.add('correct-input');
            } else {
                App.playSound('incorrect');
                this.state.mistakes.push({ prompt: word.arabic, incorrect: userAnswer, correct: word.arabic, turkish: word.turkish });
                this.dom.input.classList.add('incorrect-input');
            }
            this.state.currentIndex++;
            if (this.state.currentIndex >= this.state.words.length || this.state.timeLeft <= 0) { this.endGame(); } else { if (this.state.nextWordTimeout) clearTimeout(this.state.nextWordTimeout); this.state.nextWordTimeout = setTimeout(() => { if (this.state.timeLeft > 0 && this.dom.input) { this.dom.input.disabled = false; this.showNextWord(); } else if (this.state.timeLeft <= 0) { this.endGame(); } this.state.nextWordTimeout = null; }, 800); }
        },
        endGame() { this.stop(); this.state.endTime = Date.now(); if (this.dom.input) this.dom.input.disabled = true; const timeTakenSeconds = Math.max(1, Math.round(((this.state.endTime || Date.now()) - (this.state.startTime || Date.now() - (App.state.gameSettings.time * 1000))) / 1000)); const timeTakenMinutes = timeTakenSeconds / 60; const wpm = Math.round((this.state.correctChars / 5) / timeTakenMinutes) || 0; const attemptedWords = this.state.currentIndex; const correctWords = attemptedWords - this.state.mistakes.length; const accuracy = attemptedWords > 0 ? Math.round((correctWords / attemptedWords) * 100) : (this.state.totalTypedChars > 0 ? 0 : 100); App.showResults(this.state.score, this.state.mistakes, accuracy, wpm, App.state.gameSettings.time - Math.max(0, this.state.timeLeft)); },
        showScoreEffect(points) { if (!this.dom.effectsContainer || points <= 0) return; const effectEl = document.createElement('div'); effectEl.className = 'typing-score-effect'; effectEl.textContent = `+${points}`; this.dom.effectsContainer.appendChild(effectEl); setTimeout(() => { effectEl.remove(); }, 1450); },
        createKeyboard() {
            if(!this.dom.keyboard) return;
            this.dom.keyboard.innerHTML = '';
            const colorMap={'ب':'#a0c4ff','ت':'#a0c4ff','ث':'#a0c4ff','ن':'#a0c4ff','ي':'#a0c4ff','ج':'#caffbf','ح':'#caffbf','خ':'#caffbf','د':'#fdffb6','ذ':'#fdffb6','ر':'#ffd6a5','ز':'#ffd6a5','س':'#ffadad','ش':'#ffadad','ص':'#bdb2ff','ض':'#bdb2ff','ط':'#9bf6ff','ظ':'#9bf6ff','ع':'#ffc6ff','غ':'#ffc6ff','ف':'#b9f6ca','ق':'#b9f6ca','ه':'#b3e5fc','ة':'#b3e5fc','ء':'#ffccbc','ؤ':'#ffccbc','ئ':'#ffccbc','ا':'#e0e0e0','ل':'#e0e0e0','ك':'#d1c4e9','م':'#f8bbd0','و':'#c5cae9'}; const defaultColor='#FFFFFF';
            // ---- Güncellenmiş Klavye Düzeni (Elif ile) ----
            const keys = [
                ["د","ج","ح","خ","ه","ع","غ","ف","ق","ث","ص","ض"],
                ["ط","ك","م","ن","ت","ا","ل","ب","ي","س","ش","ذ"],
                ["ظ","ز","و","ة","ى","ر","ؤ","ء","ئ"]
            ];
            // ------------------------------------
            keys.forEach(row => { const rowDiv = document.createElement('div'); rowDiv.className = 'keyboard-row'; row.forEach(key => { const keyBtn = document.createElement('button'); keyBtn.className = 'keyboard-key'; keyBtn.textContent = key; const bgColor = colorMap[key] || defaultColor; const shadowColor = this.getDarkerColor(bgColor); keyBtn.style.backgroundColor = bgColor; keyBtn.style.boxShadow = `0 4px ${shadowColor}`; keyBtn.onmousedown = () => { keyBtn.style.transform = 'translateY(2px)'; keyBtn.style.boxShadow = `0 2px ${shadowColor}`; }; keyBtn.onmouseup = () => { keyBtn.style.transform = ''; keyBtn.style.boxShadow = `0 4px ${shadowColor}`; }; keyBtn.onmouseleave = () => { keyBtn.style.transform = ''; keyBtn.style.boxShadow = `0 4px ${shadowColor}`; }; rowDiv.appendChild(keyBtn); }); this.dom.keyboard.appendChild(rowDiv); });
            const specialRow=document.createElement('div'); specialRow.className='keyboard-row'; const spaceBtn=document.createElement('button'); spaceBtn.className='keyboard-key space-bar'; spaceBtn.textContent='مسافة'; spaceBtn.style.flexGrow='8'; const spaceBg='#CFD8DC'; const spaceShadow=this.getDarkerColor(spaceBg); spaceBtn.style.backgroundColor=spaceBg; spaceBtn.style.boxShadow=`0 4px ${spaceShadow}`; spaceBtn.onmousedown=()=>{spaceBtn.style.transform='translateY(2px)';spaceBtn.style.boxShadow=`0 2px ${spaceShadow}`;}; spaceBtn.onmouseup=()=>{spaceBtn.style.transform='';spaceBtn.style.boxShadow=`0 4px ${spaceShadow}`;}; const backspaceBtn=document.createElement('button'); backspaceBtn.className='keyboard-key backspace'; backspaceBtn.style.flexGrow='1.5'; backspaceBtn.innerHTML=`<svg viewBox="0 0 24 24"><path d="M22,3H7C6.31,3 5.77,3.35 5.41,3.88L0,12L5.41,20.11C5.77,20.64 6.31,21 7,21H22A2,2 0 0,0 24,19V5A2,2 0 0,0 22,3M19,15.59L17.59,17L14,13.41L10.41,17L9,15.59L12.59,12L9,8.41L10.41,7L14,10.59L17.59,7L19,8.41L15.41,12L19,15.59Z" /></svg>`; const backspaceBg='#e5e9f0'; const backspaceShadow=this.getDarkerColor(backspaceBg); backspaceBtn.style.backgroundColor=backspaceBg; backspaceBtn.style.boxShadow=`0 4px ${backspaceShadow}`; backspaceBtn.onmousedown=()=>{backspaceBtn.style.transform='translateY(2px)';backspaceBtn.style.boxShadow=`0 2px ${backspaceShadow}`;}; backspaceBtn.onmouseup=()=>{backspaceBtn.style.transform='';backspaceBtn.style.boxShadow=`0 4px ${backspaceShadow}`;}; specialRow.appendChild(backspaceBtn); specialRow.appendChild(spaceBtn); this.dom.keyboard.appendChild(specialRow); this.addKeyboardListeners();
        },
        addKeyboardListeners() { if(!this.dom.keyboard) return; this.dom.keyboard.onclick = null; this.dom.keyboard.onclick = (e) => { if (!this.dom.input || this.dom.input.disabled) return; const keyEl = e.target.closest('.keyboard-key'); if (!keyEl) return; App.playSound('touch'); if (keyEl.classList.contains('backspace')) this.dom.input.value = this.dom.input.value.slice(0, -1); else if (keyEl.classList.contains('space-bar')) this.dom.input.value += ' '; else this.dom.input.value += keyEl.textContent; this.dom.input.focus(); }; },
        getDarkerColor(hex) { if(!hex || hex.length < 4) return '#aaaaaa'; if(hex.length === 4) hex = '#' + hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3]; let r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16); r=Math.max(0,Math.floor(r*0.85)); g=Math.max(0,Math.floor(g*0.85)); b=Math.max(0,Math.floor(b*0.85)); return `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`; }
    };

    App.init();

    });

            // --- Optional: set CSS var to item count ---
            (function(){
              const bar = document.querySelector('.word-progress-bar');
              if (!bar) return;
              const items = bar.querySelectorAll('.word-progress-item');
              if (items.length){
                bar.style.setProperty('--progress-count', items.length);
              }
            })();

</script>
</body>
</html>